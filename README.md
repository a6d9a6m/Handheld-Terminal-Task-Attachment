# Vue AGV 智能车手持终端

## 项目简介

本项目为基于 Vue3 + Pinia + Vitest 的 AGV 智能车手持终端，支持系统参数配置、摄像头管理、云端平台接入等功能，具备完善的单元测试和高覆盖率保障。

## 功能说明

- AGV 车辆主机参数配置（IP、端口等）
- 云端平台地址配置
- 多路摄像头（地址、账号、密码）参数管理
- 配置的获取、保存、恢复初始值
- 表单校验与二次确认弹窗
- 配置变更后自动刷新系统状态
- 完善的单元测试与覆盖率报告

## 页面功能一览

### InitView.vue（系统初始化与自检页）
- 系统启动后的自检页面，自动检测文件系统、数据库、AGV车辆控制系统、摄像头等各项基础设施的连通性和状态。
- 展示每项自检的进度、结果（成功/失败/检查中），支持失败项展开查看错误详情和解决方案。
- 支持"重新检测"一键重试，全部通过后可"进入系统"，可跳转到系统设置页面。

### SettingsView.vue（系统设置页）
- AGV系统的参数配置页面，配置车辆主机IP、控制端口、分析端口、云端平台地址、多路摄像头的地址、账号、密码。
- 支持保存、取消、表单校验、二次确认，保存后自动刷新系统状态。

### TaskManageView.vue（任务管理页）
- 地铁隧道巡检任务的管理与调度中心。
- 任务列表展示、分页、搜索、筛选，支持新增、编辑、删除、启动、上传、查看任务详情。
- 任务的创建人、执行人、执行时间、完成时间等信息管理。

### TaskDetailView.vue（任务详情页）
- 单个巡检任务的详细信息与缺陷历史查看。
- 展示任务基本信息、巡视距离、完成时间、所有缺陷点的分布、图片、类型、位置。
- 支持缺陷点的快速预览、详情弹窗、状态确认（属实/疑似/误报）、补充说明。

### TaskExecuteView.vue（任务巡视执行页）
- AGV车辆实时巡视任务的操作与监控页面。
- 实时视频流监控与摄像头切换，车辆状态监控与控制（前进、后退、停止），实时缺陷点标记与进度条展示。
- 支持音量调节、静音、刷新监控、完成/终止巡检等操作，侧边栏展示车辆状态、控制台、任务进度等。

### NotFound.vue（404页面）
- 访问不存在路由时的友好提示页面，展示404状态码和趣味像素风格图案，一键返回首页。

## 主要技术栈
- Vue 3
- Pinia
- Vitest（单元测试与覆盖率）
- @vue/test-utils
- Vite

## 目录结构

```
├── mock/                # mock 数据与接口
├── public/              # 静态资源
├── src/
│   ├── api/             # Pinia store 及接口
│   ├── view/            # 视图组件与测试
│   ├── utils/           # 工具函数
│   ├── main.js          # 入口文件
│   └── ...
├── coverage/            # 覆盖率报告（运行测试后生成）
├── package.json         # 依赖与脚本
├── vite.config.js       # Vite 配置
└── README.md            # 项目说明
```

## 安装依赖

```bash
npm install
```

## 使用说明

### 启动开发环境

```bash
npm run dev
```

浏览器访问 http://localhost:5173 （默认端口）

### 常用操作流程

1. **新建任务**
   - 进入"任务管理"页面（TaskManageView.vue）。
   - 点击"新增任务"按钮，填写任务名称、编号、起始地点、距离、创建人、执行人等信息，保存任务。
   - 新建后可直接"保存并启动"进入巡视。

2. **启动任务并进入巡视**
   - 在任务列表中，点击"启动"或"保存并启动"按钮，系统自动跳转到"任务巡视执行"页面（TaskExecuteView.vue）。
   - 在巡视页面可实时查看视频流、切换摄像头、控制车辆前进/后退/停止，标记和确认缺陷点，监控任务进度和车辆状态。
   - 支持音量调节、刷新监控、完成/终止巡检等操作。

3. **查看任务详情与缺陷历史**
   - 在任务管理页面，点击某个任务的"查看"按钮，进入"任务详情"页面（TaskDetailView.vue）。
   - 可查看任务基本信息、所有缺陷点的分布、图片、类型、位置，支持缺陷点的快速预览、详情弹窗、状态确认和补充说明。

4. **系统设置（如需调整参数）**
   - 在任意页面点击设置按钮，进入"系统设置"页面（SettingsView.vue）。
   - 可配置车辆主机、端口、云端平台、摄像头参数，保存后自动刷新系统状态。

5. **系统自检与初始化**
   - 系统启动后自动进入"系统初始化与自检"页面（InitView.vue），检测各项基础设施连通性，全部通过后可进入系统。

6. **异常页面处理**
   - 访问不存在的路由时，自动跳转到 NotFound.vue，显示404提示并可一键返回首页。

### 运行单元测试

```bash
npx vitest run
```

### 生成并查看覆盖率报告

```bash
npx vitest run --coverage --coverage.reporter=html
```

运行后会在 `coverage/lcov-report/index.html` 生成可视化报告，用浏览器打开即可查看每个文件的覆盖率详情。

## 常见问题

- **覆盖率不达标？**
  - 请确保所有 v-model 绑定的 input 都在测试中 setValue 赋值，所有 store getter/setter、watch、生命周期钩子等都被直接或间接调用。
- **mock 相关问题？**
  - 测试用例中已对 axios、vue-router、element-plus 等常用依赖做了 mock，避免外部依赖影响测试。
- **如何调试测试？**
  - 可在测试用例中加 `debugger` 或 `console.log`，配合 VSCode/WebStorm 的调试功能使用。

## 贡献与维护

如需扩展功能或修复 bug，欢迎提交 PR 或 issue。

---

如有其它问题，请联系项目维护者。
